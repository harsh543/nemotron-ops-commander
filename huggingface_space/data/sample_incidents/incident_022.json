{"id":"INC-022","title":"Azure AKS cluster upgrade failure - node pools stuck","summary":"AKS cluster production-aks-01 control plane was successfully upgraded from Kubernetes 1.28.3 to 1.29.2, but the system and user node pools remained on version 1.28.3. The az aks nodepool upgrade command returned a ProvisioningState of Failed with error code ReconcileVMSSAgentPoolFailed. Nodes showed NotReady status intermittently and new deployments using 1.29 API features failed with API version errors. The cluster was in a split-version state for 6 hours before resolution.","source":"azure-docs","root_cause":"The node pool upgrade failed because a PodDisruptionBudget on the kube-system namespace blocked node drain operations. The CoreDNS PDB required minAvailable of 2 but only 2 replicas existed, making it impossible to drain any node hosting CoreDNS. Additionally, a custom DaemonSet had a terminationGracePeriodSeconds of 600 which exceeded the node drain timeout.","resolution":"Temporarily adjusted CoreDNS PDB minAvailable to 1 and scaled CoreDNS to 3 replicas. Reduced DaemonSet terminationGracePeriodSeconds to 60. Re-initiated node pool upgrade with az aks nodepool upgrade --max-surge 33%. All node pools converged to 1.29.2 within 45 minutes. Restored original PDB settings after upgrade completed.","services":["aks-cluster","node-pools","coredns","azure-vmss"],"service":"aks-cluster","severity":"P1","timestamp":"2026-01-12T09:15:00Z","tags":["azure","aks","upgrade","node-pool","pdb","vmss","kubernetes"]}